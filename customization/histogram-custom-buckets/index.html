<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Histogram custom buckets</title>
  
  <meta name="author" content="Ross A. Baker"/>
  
  
  <meta name="description" content="docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
  <script src="../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/otel4s-docs_2.13/0.5.0/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/otel4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/otel4s-docs_2.13/0.5.0/"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/otel4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../">otel4s</a></li>
    <li class="level1 nav-leaf"><a href="../../modules-structure.html">Modules structure</a></li>
    <li class="level1 nav-leaf"><a href="../../tracing-context-propagation.html">Tracing context propagation</a></li>
    <li class="level1 nav-header">Instrumentation</li>
    <li class="level2 nav-leaf"><a href="../../instrumentation/metrics.html">Metrics</a></li>
    <li class="level2 nav-leaf"><a href="../../instrumentation/metrics-jvm-runtime.html">Metrics | JVM Runtime</a></li>
    <li class="level2 nav-leaf"><a href="../../instrumentation/tracing.html">Tracing</a></li>
    <li class="level2 nav-leaf"><a href="../../instrumentation/tracing-java-interop.html">Tracing - interop with Java-instrumented libraries</a></li>
    <li class="level1 nav-header">Customization</li>
    <li class="level2 active nav-leaf"><a href="#">Histogram custom buckets</a></li>
    <li class="level1 nav-header">SDK</li>
    <li class="level2 nav-leaf"><a href="../../sdk/overview.html">Overview</a></li>
    <li class="level2 nav-leaf"><a href="../../sdk/configuration.html">Configuration</a></li>
    <li class="level1 nav-header">Examples</li>
    <li class="level2 nav-leaf"><a href="../../examples/jaeger-docker/">Jaeger - collecting traces</a></li>
    <li class="level2 nav-leaf"><a href="../../examples/honeycomb/">Honeycomb - metrics and traces</a></li>
    <li class="level2 nav-leaf"><a href="../../examples/grafana/">Grafana - All-in-one</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Histogram custom buckets</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#project-setup">Project setup</a></li>
    <li class="level1 nav-leaf"><a href="#opentelemetry-sdk-configuration">OpenTelemetry SDK configuration</a></li>
    <li class="level1 nav-node"><a href="#opentelemetry-autoconfigure-extension-customization">OpenTelemetry Autoconfigure extension customization</a></li>
    <li class="level2 nav-leaf"><a href="#instrument-selector">Instrument selector</a></li>
    <li class="level2 nav-leaf"><a href="#view-definition">View definition</a></li>
    <li class="level1 nav-leaf"><a href="#application-example">Application example</a></li>
    <li class="level1 nav-leaf"><a href="#run-the-application">Run the application</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="histogram-custom-buckets" class="title">Histogram custom buckets</h1>
        <p>By default, OpenTelemetry use the following boundary values for histogram
        bucketing:［0, 5, 10, 25, 50, 75, 100, 250, 500, 750, 1000, 2500, 5000, 7500, 10000］.</p>
        <p>In some cases, these boundaries don&#39;t represent the distribution of the values. For example, we expect that HTTP server
        latency should be somewhere between 100ms and 1s. Therefore, 2.5, 5, 7.5, and 10 seconds buckets are redundant.</p>
        <p>In this example, we will
        customize the <a href="https://opentelemetry.io/docs/instrumentation/java/manual/#auto-configuration">OpenTelemetry Autoconfigure</a>
        extension with a <a href="https://opentelemetry.io/docs/instrumentation/java/manual/#views">View</a> to configure custom buckets
        for a histogram.</p>
        
        <h3 id="project-setup" class="section"><a class="anchor-link left" href="#project-setup"><i class="icofont-laika link">&#xef71;</i></a>Project setup</h3>
        <p>Configure the project using your favorite tool:</p>
        <div class="tab-container" data-tab-group="build-tool">
          <ul class="tab-group">
            <li class="tab active" data-choice-name="sbt"><a href="#">sbt</a></li>
            <li class="tab" data-choice-name="scala-cli"><a href="#">Scala CLI</a></li>
          </ul>
          <div class="tab-content active" data-choice-name="sbt">
            <p>Add settings to the <code>build.sbt</code>:</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">libraryDependencies</span><span> ++= </span><span class="type-name">Seq</span><span>(
  </span><span class="string-literal">&quot;org.typelevel&quot;</span><span> %% </span><span class="string-literal">&quot;otel4s-oteljava&quot;</span><span> % </span><span class="string-literal">&quot;0.5.0&quot;</span><span>, </span><span class="comment">// &lt;1&gt;
</span><span>  </span><span class="string-literal">&quot;io.opentelemetry&quot;</span><span> % </span><span class="string-literal">&quot;opentelemetry-exporter-otlp&quot;</span><span> % </span><span class="string-literal">&quot;1.36.0&quot;</span><span> % </span><span class="type-name">Runtime</span><span>, </span><span class="comment">// &lt;2&gt;
</span><span>  </span><span class="string-literal">&quot;io.opentelemetry&quot;</span><span> % </span><span class="string-literal">&quot;opentelemetry-sdk-extension-autoconfigure&quot;</span><span> % </span><span class="string-literal">&quot;1.36.0&quot;</span><span> % </span><span class="type-name">Runtime</span><span> </span><span class="comment">// &lt;3&gt;
</span><span>)
</span><span class="identifier">run</span><span> / </span><span class="identifier">fork</span><span> := </span><span class="boolean-literal">true</span><span>
</span><span class="identifier">javaOptions</span><span> += </span><span class="string-literal">&quot;-Dotel.service.name=histogram-buckets-example&quot;</span><span> </span><span class="comment">// &lt;4&gt;</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="scala-cli">
            <p>Add directives to the <code>histogram-buckets.scala</code>:</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">//&gt; using lib &quot;org.typelevel::otel4s-oteljava:0.5.0&quot; // &lt;1&gt;
//&gt; using lib &quot;io.opentelemetry:opentelemetry-exporter-otlp:1.36.0&quot; // &lt;2&gt;
//&gt; using lib &quot;io.opentelemetry:opentelemetry-sdk-extension-autoconfigure:1.36.0&quot; // &lt;3&gt;
//&gt; using `java-opt` &quot;-Dotel.service.name=histogram-buckets-example&quot; // &lt;4&gt;</span></code></pre>
          </div>
        </div>
        <p>1) Add the <code>otel4s</code> library<br>
        2) Add an OpenTelemetry exporter. Without the exporter, the application will crash<br>
        3) Add an OpenTelemetry autoconfigure extension<br>
        4) Add the name of the application to use in the traces and metrics</p>
        
        <h3 id="opentelemetry-sdk-configuration" class="section"><a class="anchor-link left" href="#opentelemetry-sdk-configuration"><i class="icofont-laika link">&#xef71;</i></a>OpenTelemetry SDK configuration</h3>
        <p>As mentioned above, we use <code>otel.service.name</code> system properties to configure the OpenTelemetry SDK.
        The SDK can be configured via environment variables too. Check the full list
        of <a href="https://github.com/open-telemetry/opentelemetry-java/blob/main/sdk-extensions/autoconfigure/README.md">environment variable configurations</a>
        for more options.</p>
        
        <h3 id="opentelemetry-autoconfigure-extension-customization" class="section"><a class="anchor-link left" href="#opentelemetry-autoconfigure-extension-customization"><i class="icofont-laika link">&#xef71;</i></a>OpenTelemetry Autoconfigure extension customization</h3>
        <p>We can utilize <code>AutoConfiguredOpenTelemetrySdk.builder</code> to customize the <code>MeterProvider</code> and, as the result, a histogram
        bucket. This approach leverages the automatic configuration functionality (e.g. configuring context propagators through
        environment variables) and provides a handy way to re-configure some components.</p>
        <p>In order to register a view, there are two essential components that must be provided: an instrument selector and a view
        definition.</p>
        
        <h4 id="instrument-selector" class="section"><a class="anchor-link left" href="#instrument-selector"><i class="icofont-laika link">&#xef71;</i></a>Instrument selector</h4>
        <p>Here we establish the configuration for replacing <strong>existing</strong> instruments.</p>
        <p>In the following example, we specifically target an instrument of type <code>HISTOGRAM</code> with the
        name <code>service.work.duration</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">opentelemetry</span><span>.</span><span class="identifier">sdk</span><span>.</span><span class="identifier">metrics</span><span>.{</span><span class="type-name">InstrumentSelector</span><span>, </span><span class="type-name">InstrumentType</span><span>}

</span><span class="type-name">InstrumentSelector</span><span>
  .</span><span class="identifier">builder</span><span>()
  .</span><span class="identifier">setName</span><span>(</span><span class="string-literal">&quot;service.work.duration&quot;</span><span>)
  .</span><span class="identifier">setType</span><span>(</span><span class="type-name">InstrumentType</span><span>.</span><span class="type-name">HISTOGRAM</span><span>)
  .</span><span class="identifier">build</span><span>()</span></code></pre>
        <p>To select multiple instruments, a wildcard pattern can be used: <code>service.*.duration</code>.</p>
        
        <h4 id="view-definition" class="section"><a class="anchor-link left" href="#view-definition"><i class="icofont-laika link">&#xef71;</i></a>View definition</h4>
        <p>The view determines how the selected instruments should be changed or aggregated.</p>
        <p>In our particular case, we create a histogram view with custom buckets:［.005, .01, .025, .05, .075, .1, .25, .5］.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">opentelemetry</span><span>.</span><span class="identifier">sdk</span><span>.</span><span class="identifier">metrics</span><span>.{</span><span class="type-name">Aggregation</span><span>, </span><span class="type-name">View</span><span>}

</span><span class="type-name">View</span><span>
  .</span><span class="identifier">builder</span><span>()
  .</span><span class="identifier">setName</span><span>(</span><span class="string-literal">&quot;service.work.duration&quot;</span><span>)
  .</span><span class="identifier">setAggregation</span><span>(
    </span><span class="type-name">Aggregation</span><span>.</span><span class="identifier">explicitBucketHistogram</span><span>(
      </span><span class="identifier">java</span><span>.</span><span class="identifier">util</span><span>.</span><span class="type-name">Arrays</span><span>.</span><span class="identifier">asList</span><span>(</span><span class="number-literal">.005</span><span>, </span><span class="number-literal">.01</span><span>, </span><span class="number-literal">.025</span><span>, </span><span class="number-literal">.05</span><span>, </span><span class="number-literal">.075</span><span>, </span><span class="number-literal">.1</span><span>, </span><span class="number-literal">.25</span><span>, </span><span class="number-literal">.5</span><span>)
    )
  )
  .</span><span class="identifier">build</span><span>()</span></code></pre>
        
        <h3 id="application-example" class="section"><a class="anchor-link left" href="#application-example"><i class="icofont-laika link">&#xef71;</i></a>Application example</h3>
        <p>By putting all the snippets together, we get the following:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="type-name">Parallel</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">kernel</span><span>.</span><span class="type-name">Temporal</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">std</span><span>.</span><span class="type-name">Console</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">std</span><span>.</span><span class="type-name">Random</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">flatMap</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">functor</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">parallel</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">opentelemetry</span><span>.</span><span class="identifier">sdk</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">Aggregation</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">opentelemetry</span><span>.</span><span class="identifier">sdk</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">InstrumentSelector</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">opentelemetry</span><span>.</span><span class="identifier">sdk</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">InstrumentType</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">opentelemetry</span><span>.</span><span class="identifier">sdk</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">View</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">oteljava</span><span>.</span><span class="identifier">context</span><span>.</span><span class="type-name">LocalContextProvider</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">oteljava</span><span>.</span><span class="type-name">OtelJava</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">Histogram</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">java</span><span>.</span><span class="identifier">util</span><span>.</span><span class="identifier">concurrent</span><span>.</span><span class="type-name">TimeUnit</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">concurrent</span><span>.</span><span class="identifier">duration</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">object</span><span> </span><span class="type-name">HistogramBucketsExample</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">IOApp</span><span>.</span><span class="type-name">Simple</span><span> {

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">work</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Temporal</span><span>: </span><span class="type-name">Console</span><span>](
    </span><span class="identifier">histogram</span><span>: </span><span class="type-name">Histogram</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Double</span><span>], 
    </span><span class="identifier">random</span><span>: </span><span class="type-name">Random</span><span>[</span><span class="type-name">F</span><span>]
  ): </span><span class="type-name">F</span><span>[</span><span class="type-name">Unit</span><span>] =
    </span><span class="keyword">for</span><span> {
      </span><span class="identifier">sleepDuration</span><span> &lt;- </span><span class="identifier">random</span><span>.</span><span class="identifier">nextIntBounded</span><span>(</span><span class="number-literal">5000</span><span>)
      </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">histogram</span><span>
        .</span><span class="identifier">recordDuration</span><span>(</span><span class="type-name">TimeUnit</span><span>.</span><span class="type-name">SECONDS</span><span>)
        .</span><span class="identifier">surround</span><span>(
          </span><span class="type-name">Temporal</span><span>[</span><span class="type-name">F</span><span>].</span><span class="identifier">sleep</span><span>(</span><span class="identifier">sleepDuration</span><span>.</span><span class="identifier">millis</span><span>) &gt;&gt;
            </span><span class="type-name">Console</span><span>[</span><span class="type-name">F</span><span>].</span><span class="identifier">println</span><span>(</span><span class="string-literal">s&quot;I&#39;m working after [</span><span class="substitution">$sleepDuration</span><span class="string-literal"> ms]&quot;</span><span>)
        )
    } </span><span class="keyword">yield</span><span> ()

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">program</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Async</span><span>: </span><span class="type-name">LocalContextProvider</span><span>: </span><span class="type-name">Parallel</span><span>: </span><span class="type-name">Console</span><span>]: </span><span class="type-name">F</span><span>[</span><span class="type-name">Unit</span><span>] =
    </span><span class="identifier">configureSdk</span><span>[</span><span class="type-name">F</span><span>]
      .</span><span class="identifier">evalMap</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">meterProvider</span><span>.</span><span class="identifier">get</span><span>(</span><span class="string-literal">&quot;histogram-example&quot;</span><span>))
      .</span><span class="identifier">use</span><span> { </span><span class="identifier">meter</span><span> =&gt;
        </span><span class="keyword">for</span><span> {
          </span><span class="identifier">random</span><span> &lt;- </span><span class="type-name">Random</span><span>.</span><span class="identifier">scalaUtilRandom</span><span>[</span><span class="type-name">F</span><span>]
          </span><span class="identifier">histogram</span><span> &lt;- </span><span class="identifier">meter</span><span>.</span><span class="identifier">histogram</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="string-literal">&quot;service.work.duration&quot;</span><span>).</span><span class="identifier">create</span><span>
          </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">work</span><span>[</span><span class="type-name">F</span><span>](</span><span class="identifier">histogram</span><span>, </span><span class="identifier">random</span><span>).</span><span class="identifier">parReplicateA_</span><span>(</span><span class="number-literal">50</span><span>)
        } </span><span class="keyword">yield</span><span> ()
      }

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>: </span><span class="type-name">IO</span><span>[</span><span class="type-name">Unit</span><span>] =
    </span><span class="identifier">program</span><span>[</span><span class="type-name">IO</span><span>]

  </span><span class="keyword">private</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">configureSdk</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Async</span><span>: </span><span class="type-name">LocalContextProvider</span><span>]: </span><span class="type-name">Resource</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">OtelJava</span><span>[</span><span class="type-name">F</span><span>]] =
    </span><span class="type-name">OtelJava</span><span>.</span><span class="identifier">autoConfigured</span><span> { </span><span class="identifier">sdkBuilder</span><span> =&gt;
      </span><span class="identifier">sdkBuilder</span><span>
        .</span><span class="identifier">addMeterProviderCustomizer</span><span> { (</span><span class="identifier">meterProviderBuilder</span><span>, </span><span class="identifier">_</span><span>) =&gt;
          </span><span class="identifier">meterProviderBuilder</span><span>
            .</span><span class="identifier">registerView</span><span>(
              </span><span class="type-name">InstrumentSelector</span><span>
                .</span><span class="identifier">builder</span><span>()
                .</span><span class="identifier">setName</span><span>(</span><span class="string-literal">&quot;service.work.duration&quot;</span><span>)
                .</span><span class="identifier">setType</span><span>(</span><span class="type-name">InstrumentType</span><span>.</span><span class="type-name">HISTOGRAM</span><span>)
                .</span><span class="identifier">build</span><span>(),
              </span><span class="type-name">View</span><span>
                .</span><span class="identifier">builder</span><span>()
                .</span><span class="identifier">setName</span><span>(</span><span class="string-literal">&quot;service.work.duration&quot;</span><span>)
                .</span><span class="identifier">setAggregation</span><span>(
                  </span><span class="type-name">Aggregation</span><span>.</span><span class="identifier">explicitBucketHistogram</span><span>(
                    </span><span class="identifier">java</span><span>.</span><span class="identifier">util</span><span>.</span><span class="type-name">Arrays</span><span>.</span><span class="identifier">asList</span><span>(</span><span class="number-literal">.005</span><span>, </span><span class="number-literal">.01</span><span>, </span><span class="number-literal">.025</span><span>, </span><span class="number-literal">.05</span><span>, </span><span class="number-literal">.075</span><span>, </span><span class="number-literal">.1</span><span>, </span><span class="number-literal">.25</span><span>, </span><span class="number-literal">.5</span><span>)
                  )
                )
                .</span><span class="identifier">build</span><span>()
            )
        }
        .</span><span class="identifier">setResultAsGlobal</span><span>
    }
}</span></code></pre>
        
        <h3 id="run-the-application" class="section"><a class="anchor-link left" href="#run-the-application"><i class="icofont-laika link">&#xef71;</i></a>Run the application</h3>
        <div class="tab-container" data-tab-group="build-tool">
          <ul class="tab-group">
            <li class="tab active" data-choice-name="sbt"><a href="#">sbt</a></li>
            <li class="tab" data-choice-name="scala-cli"><a href="#">Scala CLI</a></li>
          </ul>
          <div class="tab-content active" data-choice-name="sbt">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ sbt run</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="scala-cli">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ scala-cli run histogram-buckets.scala</span></code></pre>
          </div>
        </div>

        
<hr class="footer-rule"/>
<footer>
  otel4s is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>