<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Semantic conventions</title>
  
  <meta name="author" content="Ross A. Baker"/>
  
  
  <meta name="description" content="docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/otel4s-docs_2.13/0.15.1/org/typelevel/otel4s/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/otel4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.typelevel/otel4s-docs_2.13/0.15.1/org/typelevel/otel4s/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/otel4s"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../">otel4s</a></li>
    <li class="level1 nav-leaf"><a href="../modules-structure.html">Modules structure</a></li>
    <li class="level1 nav-leaf"><a href="../tracing-context-propagation.html">Tracing context propagation</a></li>
    <li class="level1 nav-leaf"><a href="../ecosystem.html">Ecosystem</a></li>
    <li class="level1 nav-header">Instrumentation</li>
    <li class="level2 nav-leaf"><a href="metrics.html">Metrics</a></li>
    <li class="level2 nav-leaf"><a href="metrics-cats-effect-io-runtime.html">Metrics | Cats Effect IO runtime</a></li>
    <li class="level2 nav-leaf"><a href="tracing.html">Tracing</a></li>
    <li class="level2 nav-leaf"><a href="tracing-cross-service-propagation.html">Tracing | Cross-service propagation</a></li>
    <li class="level2 nav-leaf"><a href="logs.html">Logs</a></li>
    <li class="level2 nav-leaf"><a href="baggage.html">Baggage</a></li>
    <li class="level2 active nav-leaf"><a href="#">Semantic conventions</a></li>
    <li class="level1 nav-header">Customization</li>
    <li class="level2 nav-leaf"><a href="../customization/histogram-custom-buckets/">Histogram custom buckets</a></li>
    <li class="level1 nav-header">OtelJava</li>
    <li class="level2 nav-leaf"><a href="../oteljava/overview.html">Overview</a></li>
    <li class="level2 nav-leaf"><a href="../oteljava/metrics-jvm-runtime.html">Metrics | JVM Runtime</a></li>
    <li class="level2 nav-leaf"><a href="../oteljava/tracing-context-propagation.html">Tracing | Context propagation</a></li>
    <li class="level2 nav-leaf"><a href="../oteljava/tracing-java-interop.html">Tracing | Interop with Java-instrumented libraries</a></li>
    <li class="level2 nav-leaf"><a href="../oteljava/agent.html">Zero-code | Java Agent</a></li>
    <li class="level2 nav-leaf"><a href="../oteljava/testkit.html">Testkit</a></li>
    <li class="level1 nav-header">SDK</li>
    <li class="level2 nav-leaf"><a href="../sdk/overview.html">Overview</a></li>
    <li class="level1 nav-header">Examples</li>
    <li class="level2 nav-leaf"><a href="../examples/jaeger-docker/">Jaeger - collecting traces</a></li>
    <li class="level2 nav-leaf"><a href="../examples/honeycomb/">Honeycomb - metrics and traces</a></li>
    <li class="level2 nav-leaf"><a href="../examples/dash0/">Dash0 - metrics and traces</a></li>
    <li class="level2 nav-leaf"><a href="../examples/grafana/">Grafana - All-in-one</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Semantic conventions</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#modules-overview">Modules overview</a></li>
    <li class="level1 nav-leaf"><a href="#getting-started">Getting started</a></li>
    <li class="level1 nav-leaf"><a href="#use-semantic-attribute-keys">Use semantic attribute keys</a></li>
    <li class="level1 nav-leaf"><a href="#use-semantic-metric-specs">Use semantic metric specs</a></li>
    <li class="level1 nav-leaf"><a href="#use-metric-specs-in-tests">Use metric specs in tests</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="semantic-conventions" class="title">Semantic conventions</h1>
        <p>Semantic conventions standardize attribute and metric names across instrumentation so telemetry is comparable across
        libraries and services. The <code>semconv</code> modules provide generated, typesafe attribute keys and metric specs that match the
        <a href="https://opentelemetry.io/docs/specs/semconv/">OpenTelemetry semantic conventions</a> specification.</p>
        
        <h2 id="modules-overview" class="section"><a class="anchor-link left" href="#modules-overview"><i class="icofont-laika link">&#xef71;</i></a>Modules overview</h2>
        <table>
          <thead>
            <tr>
              <th>Module</th>
              <th>Stability</th>
              <th>Package prefix</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>otel4s-semconv</code></td>
              <td>Stable</td>
              <td><code>org.typelevel.otel4s.semconv.attributes</code></td>
            </tr>
            <tr>
              <td><code>otel4s-semconv-metrics</code></td>
              <td>Stable</td>
              <td><code>org.typelevel.otel4s.semconv.metrics</code></td>
            </tr>
            <tr>
              <td><code>otel4s-semconv-experimental</code></td>
              <td>Incubating</td>
              <td><code>org.typelevel.otel4s.semconv.experimental.attributes</code></td>
            </tr>
            <tr>
              <td><code>otel4s-semconv-metrics-experimental</code></td>
              <td>Incubating</td>
              <td><code>org.typelevel.otel4s.semconv.experimental.metrics</code></td>
            </tr>
          </tbody>
        </table>
        <p>Stable modules track the stable spec, while experimental modules track incubating conventions. 
        Use stable modules by default. The experimental modules track incubating semantic conventions and can change between
        versions. </p>
        <div class="callout warning">
          <i class="icofont-laika warning">&#xf026;</i>
          <p>The <code>*-experimental</code> modules have no binary-compatibility guarantees between releases and may introduce binary breaking
          changes at any time.</p>
        </div>
        
        <h2 id="getting-started" class="section"><a class="anchor-link left" href="#getting-started"><i class="icofont-laika link">&#xef71;</i></a>Getting started</h2>
        <div class="tab-container" data-tab-group="build-tool">
          <ul class="tab-group">
            <li class="tab active" data-choice-name="sbt"><a href="#">sbt</a></li>
            <li class="tab" data-choice-name="scala-cli"><a href="#">Scala CLI</a></li>
          </ul>
          <div class="tab-content active" data-choice-name="sbt">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">libraryDependencies</span><span> ++= </span><span class="type-name">Seq</span><span>(
  </span><span class="string-literal">&quot;org.typelevel&quot;</span><span> %% </span><span class="string-literal">&quot;otel4s-semconv&quot;</span><span>         % </span><span class="string-literal">&quot;0.15.1&quot;</span><span>, </span><span class="comment">// stable attributes
</span><span>  </span><span class="string-literal">&quot;org.typelevel&quot;</span><span> %% </span><span class="string-literal">&quot;otel4s-semconv-metrics&quot;</span><span> % </span><span class="string-literal">&quot;0.15.1&quot;</span><span>, </span><span class="comment">// stable metric specs
</span><span>)</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="scala-cli">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">//&gt; using dep &quot;org.typelevel::otel4s-semconv:0.15.1&quot;         // stable attributes
//&gt; using dep &quot;org.typelevel::otel4s-semconv-metrics:0.15.1&quot; // stable metric specs</span></code></pre>
          </div>
        </div>
        <p>If you need incubating conventions, add the <code>-experimental</code> variants instead of the stable ones.</p>
        
        <h2 id="use-semantic-attribute-keys" class="section"><a class="anchor-link left" href="#use-semantic-attribute-keys"><i class="icofont-laika link">&#xef71;</i></a>Use semantic attribute keys</h2>
        <p>The generated attribute keys are typesafe and can be used to build an attribute.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="type-name">Attributes</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">semconv</span><span>.</span><span class="identifier">attributes</span><span>.{</span><span class="type-name">ExceptionAttributes</span><span>, </span><span class="type-name">HttpAttributes</span><span>}

</span><span class="keyword">val</span><span> </span><span class="identifier">attrs</span><span> = </span><span class="type-name">Attributes</span><span>(
  </span><span class="type-name">HttpAttributes</span><span>.</span><span class="type-name">HttpRequestMethod</span><span>(</span><span class="string-literal">&quot;GET&quot;</span><span>),
  </span><span class="type-name">HttpAttributes</span><span>.</span><span class="type-name">HttpResponseStatusCode</span><span>(</span><span class="number-literal">200</span><span>),
  </span><span class="type-name">ExceptionAttributes</span><span>.</span><span class="type-name">ExceptionType</span><span>(</span><span class="string-literal">&quot;java.lang.RuntimeException&quot;</span><span>)
)</span></code></pre>
        <p>The same keys work for spans, log records, or metric attributes because they are plain <code>AttributeKey[A]</code> values.</p>
        
        <h2 id="use-semantic-metric-specs" class="section"><a class="anchor-link left" href="#use-semantic-metric-specs"><i class="icofont-laika link">&#xef71;</i></a>Use semantic metric specs</h2>
        <p>Semantic metric specs provide the canonical metric name, unit, description, and attribute expectations.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">metrics</span><span>.{</span><span class="type-name">BucketBoundaries</span><span>, </span><span class="type-name">Histogram</span><span>, </span><span class="type-name">Meter</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">semconv</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">HttpMetrics</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">createHttpClientDuration</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Meter</span><span>](
  </span><span class="identifier">boundaries</span><span>: </span><span class="type-name">BucketBoundaries</span><span>
): </span><span class="type-name">F</span><span>[</span><span class="type-name">Histogram</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Double</span><span>]] =
  </span><span class="type-name">Meter</span><span>[</span><span class="type-name">F</span><span>]
    .</span><span class="identifier">histogram</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="type-name">HttpMetrics</span><span>.</span><span class="type-name">ClientRequestDuration</span><span>.</span><span class="identifier">name</span><span>)
    .</span><span class="identifier">withUnit</span><span>(</span><span class="type-name">HttpMetrics</span><span>.</span><span class="type-name">ClientRequestDuration</span><span>.</span><span class="identifier">unit</span><span>)
    .</span><span class="identifier">withDescription</span><span>(</span><span class="type-name">HttpMetrics</span><span>.</span><span class="type-name">ClientRequestDuration</span><span>.</span><span class="identifier">description</span><span>)
    .</span><span class="identifier">withExplicitBucketBoundaries</span><span>(</span><span class="identifier">boundaries</span><span>)
    .</span><span class="identifier">create</span></code></pre>
        <p>For convenience, every metric also has the generated <code>create</code> method, that creates an instrument with the
        spec&#39;s name, unit, and description. The example below is equivalent to the previous one:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">metrics</span><span>.{</span><span class="type-name">BucketBoundaries</span><span>, </span><span class="type-name">Histogram</span><span>, </span><span class="type-name">Meter</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">semconv</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">HttpMetrics</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">createHttpClientDuration</span><span>[</span><span class="type-name">F</span><span>[</span><span class="identifier">_</span><span>]: </span><span class="type-name">Meter</span><span>](
  </span><span class="identifier">boundaries</span><span>: </span><span class="type-name">BucketBoundaries</span><span>
): </span><span class="type-name">F</span><span>[</span><span class="type-name">Histogram</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Double</span><span>]] =
  </span><span class="type-name">HttpMetrics</span><span>.</span><span class="type-name">ClientRequestDuration</span><span>.</span><span class="identifier">create</span><span>[</span><span class="type-name">F</span><span>, </span><span class="type-name">Double</span><span>](</span><span class="identifier">boundaries</span><span>)</span></code></pre>
        
        <h2 id="use-metric-specs-in-tests" class="section"><a class="anchor-link left" href="#use-metric-specs-in-tests"><i class="icofont-laika link">&#xef71;</i></a>Use metric specs in tests</h2>
        <p>Metric specs are also useful for validating exported metrics. The example below checks that expected server metrics
        exist and that each exported metric matches the semantic name, unit, description, and required attributes.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">Meter</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">semconv</span><span>.</span><span class="type-name">MetricSpec</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">semconv</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">HttpMetrics</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">semconv</span><span>.</span><span class="type-name">Requirement</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">oteljava</span><span>.</span><span class="identifier">testkit</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="type-name">MetricsTestkit</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">typelevel</span><span>.</span><span class="identifier">otel4s</span><span>.</span><span class="identifier">oteljava</span><span>.</span><span class="identifier">testkit</span><span>.</span><span class="identifier">metrics</span><span>.</span><span class="identifier">data</span><span>.</span><span class="type-name">Metric</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">semanticTest</span><span>(</span><span class="identifier">scenario</span><span>: </span><span class="type-name">Meter</span><span>[</span><span class="type-name">IO</span><span>] =&gt; </span><span class="type-name">IO</span><span>[</span><span class="type-name">Unit</span><span>]): </span><span class="type-name">IO</span><span>[</span><span class="type-name">Unit</span><span>] = {
  </span><span class="comment">// the set of metrics to check
</span><span>  </span><span class="keyword">val</span><span> </span><span class="identifier">specs</span><span> = </span><span class="type-name">List</span><span>(
    </span><span class="type-name">HttpMetrics</span><span>.</span><span class="type-name">ServerRequestDuration</span><span>
  )

  </span><span class="type-name">MetricsTestkit</span><span>.</span><span class="identifier">inMemory</span><span>[</span><span class="type-name">IO</span><span>]().</span><span class="identifier">use</span><span> { </span><span class="identifier">testkit</span><span> =&gt;
    </span><span class="identifier">testkit</span><span>.</span><span class="identifier">meterProvider</span><span>.</span><span class="identifier">get</span><span>(</span><span class="string-literal">&quot;meter&quot;</span><span>).</span><span class="identifier">flatMap</span><span> { </span><span class="identifier">meter</span><span> =&gt;
      </span><span class="keyword">for</span><span> {
        </span><span class="comment">// run a scenario to generate metrics 
</span><span>        </span><span class="identifier">_</span><span>       &lt;- </span><span class="identifier">scenario</span><span>(</span><span class="identifier">meter</span><span>)
        </span><span class="comment">// collect metrics
</span><span>        </span><span class="identifier">metrics</span><span> &lt;- </span><span class="identifier">testkit</span><span>.</span><span class="identifier">collectMetrics</span><span>[</span><span class="type-name">Metric</span><span>]
        </span><span class="comment">// ensure the expected metrics exist and match the spec
</span><span>      } </span><span class="keyword">yield</span><span> </span><span class="identifier">specs</span><span>.</span><span class="identifier">foreach</span><span>(</span><span class="identifier">spec</span><span> =&gt; </span><span class="identifier">specTest</span><span>(</span><span class="identifier">metrics</span><span>, </span><span class="identifier">spec</span><span>))
    }
  }
}

</span><span class="keyword">def</span><span> </span><span class="declaration-name">specTest</span><span>(</span><span class="identifier">metrics</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">Metric</span><span>], </span><span class="identifier">spec</span><span>: </span><span class="type-name">MetricSpec</span><span>): </span><span class="type-name">Unit</span><span> = {
  </span><span class="keyword">val</span><span> </span><span class="identifier">metric</span><span> = </span><span class="identifier">metrics</span><span>.</span><span class="identifier">find</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">name</span><span> == </span><span class="identifier">spec</span><span>.</span><span class="identifier">name</span><span>)
  </span><span class="identifier">assert</span><span>(
    </span><span class="identifier">metric</span><span>.</span><span class="identifier">isDefined</span><span>,
    </span><span class="string-literal">s&quot;</span><span class="substitution">${spec.name}</span><span class="string-literal"> metric is missing. Available [</span><span class="substitution">${metrics.map(_.name).mkString(&quot;, &quot;)}</span><span class="string-literal">]&quot;</span><span>,
  )

  </span><span class="keyword">val</span><span> </span><span class="identifier">clue</span><span> = </span><span class="string-literal">s&quot;[</span><span class="substitution">${spec.name}</span><span class="string-literal">] has a mismatched property&quot;</span><span>

  </span><span class="identifier">metric</span><span>.</span><span class="identifier">foreach</span><span> { </span><span class="identifier">md</span><span> =&gt;
    </span><span class="identifier">assert</span><span>(</span><span class="identifier">md</span><span>.</span><span class="identifier">name</span><span> == </span><span class="identifier">spec</span><span>.</span><span class="identifier">name</span><span>, </span><span class="identifier">clue</span><span>)
    </span><span class="identifier">assert</span><span>(</span><span class="identifier">md</span><span>.</span><span class="identifier">description</span><span> == </span><span class="type-name">Some</span><span>(</span><span class="identifier">spec</span><span>.</span><span class="identifier">description</span><span>), </span><span class="identifier">clue</span><span>)
    </span><span class="identifier">assert</span><span>(</span><span class="identifier">md</span><span>.</span><span class="identifier">unit</span><span> == </span><span class="type-name">Some</span><span>(</span><span class="identifier">spec</span><span>.</span><span class="identifier">unit</span><span>), </span><span class="identifier">clue</span><span>)

    </span><span class="keyword">val</span><span> </span><span class="identifier">required</span><span> = </span><span class="identifier">spec</span><span>.</span><span class="identifier">attributeSpecs</span><span>
      .</span><span class="identifier">filter</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">requirement</span><span>.</span><span class="identifier">level</span><span> == </span><span class="type-name">Requirement</span><span>.</span><span class="type-name">Level</span><span>.</span><span class="type-name">Required</span><span>)
      .</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">key</span><span>)
      .</span><span class="identifier">toSet</span><span>

    </span><span class="keyword">val</span><span> </span><span class="identifier">current</span><span> = </span><span class="identifier">md</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">points</span><span>.</span><span class="identifier">toVector</span><span>
      .</span><span class="identifier">flatMap</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">attributes</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">key</span><span>))
      .</span><span class="identifier">filter</span><span>(</span><span class="identifier">key</span><span> =&gt; </span><span class="identifier">required</span><span>.</span><span class="identifier">contains</span><span>(</span><span class="identifier">key</span><span>))
      .</span><span class="identifier">toSet</span><span>

    </span><span class="identifier">assert</span><span>(</span><span class="identifier">current</span><span> == </span><span class="identifier">required</span><span>, </span><span class="identifier">clue</span><span>)
  }
}</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  otel4s is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>